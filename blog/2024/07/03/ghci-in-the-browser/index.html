<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>GHCi in the Browser - Vaibhav Sagar</title>
        <link href="data:," rel="icon">
        <link rel="stylesheet" type="text/css" href="../../../../../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../../../../../css/syntax.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../../../../../">Vaibhav Sagar</a>
            </div>
            <div id="navigation">
                <a href="../../../../../about/">About</a>
                <a href="../../../../../talks/">Talks</a>
                <a href="../../../../../archive/">Archive</a>
            </div>
        </div>

        <div id="content">
            <h1>GHCi in the Browser</h1>

            <div class="info">
    Posted on  3 July 2024
    
</div>
<div class="info">
    
        Tags: <a title="All pages tagged 'haskell'." href="../../../../../blog/tags/haskell/" rel="tag">haskell</a>, <a title="All pages tagged 'programming'." href="../../../../../blog/tags/programming/" rel="tag">programming</a>
    
</div>

<p>I’m happy to announce that you can now run GHCi entirely in your browser (if
your browser supports WebAssembly and you’re willing to download approximately
700MB of WASM).</p>
<h2 id="where">Where?</h2>
<p><a href="https://vaibhavsagar.com/amd64-ghc-wasi-demo">Here</a>.</p>
<h2 id="how">How?</h2>
<p>I used <a href="https://github.com/ktock/container2wasm"><code>container2wasm</code></a> to convert
an OCI image containing GHC to a WASM blob that I could serve using a lightly
modified <a href="https://github.com/ktock/container2wasm-demo"><code>container2wasm-demo</code></a>.
If you’re curious, the website repo is
<a href="https://github.com/vaibhavsagar/amd64-ghc-wasi-demo">here</a> and the chunks of
WASM are <a href="https://github.com/vaibhavsagar/amd64-ghc-wasi-container">here</a>.</p>
<p>As of this writing, only images with an uncompressed size below 2GB can be used
with <code>container2wasm</code> (tracked
<a href="https://github.com/ktock/container2wasm/issues/230">here</a>) and my initial
attempts using an OCI image generated by Nix were unsuccessful because of
duplicate filenames (tracked
<a href="https://github.com/ktock/container2wasm/issues/263">here</a>).</p>
<h2 id="why">Why?</h2>
<p>I’ve wanted to do something like this for a long time. In my capacity as
a maintainer of <a href="https://github.com/IHaskell/IHaskell">IHaskell</a>, installation
issues are the most common category of support request I receive. Wouldn’t it
be great if a user could simply navigate to a webpage and have a correctly
configured Jupyter notebook waiting for them? The Jupyter folks also seem to be
thinking the same thing, based on the existence of
<a href="https://jupyterlite.readthedocs.io/en/stable/">JupyterLite</a>. Unfortunately
we’re a long way off from Haskell support<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, but I hope my proof-of-concept
shows that this is possible.</p>
<p>Even outside Jupyter-land, a fully-functional GHCi REPL in the browser would be
generally useful. For example, currently
<a href="https://www.haskell.org/">Haskell.org</a> has a “Try it!” section where you can
enter expressions, which are currently passed to a backend server to execute.
A client-side GHCi could provide a better experience and allow us to get rid of
the backend entirely. Another wild idea: the Hackage documentation for
a package could provide a REPL with that package pre-installed for users to try
out immediately. Wouldn’t that be amazing?</p>
<h2 id="why-not-compile-ghci-directly-to-javascriptwasm-using-the-new-backends">Why not compile GHCi directly to JavaScript/WASM using the new backends?</h2>
<p>I don’t think that would work/result in a usable Haskell interpreter with
access to <code>base</code> or other GHC boot packages. As of this writing it is on <a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/javascript-backend?version_id=bff087ec5b0231e12b3a8d902522f3d41aed530b">the
roadmap for GHC
9.12+</a>
so hopefully that will eventually be possible. If you get this working I’d love
to know about it!</p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>It’s not something I’m working on and I don’t know how to go from this
Goldbergian blob of WASM to a kernel that would work with JupyterLite. If you
have ideas, please get in touch!<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

        </div>
        <div id="footer">
            <div class="rc-webring">
                <a href="https://webring.recurse.com"><img src="https://webring.recurse.com/icon.svg" /> RC Webring</a>
            </div>
            <div class="rc-scout">
                <script async defer src="https://www.recurse-scout.com/loader.js?t=5ac465e5d3396a7e491e42afac4c5c90"></script>
            </div>
        </div>
        <script data-goatcounter="https://vaibhavsagar.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
    </body>
</html>
